---
layout: post
title: "xss原理"
data: 2019-04-10
tags: [security， web_security]
excerpt: "xss原理"
comments: false
share: false
---

## xss原理

1. 什么是XSS攻击？原理是什么？

    XSS攻击是跨站脚本攻击，又叫HTML注入或者JS注入

    当网站允许用户进行文本输入，并且对输入进行显示，XSS漏洞就可能存在，攻击者可以利用这个漏洞，注入HTML代码或者JS代码，改变网站HTML的展示、盗取cookie、配合其他漏洞可以进行进一步的攻击

2. XSS攻击的类型

    反射型、DOM型、存储型

    - 反射型

        主要原理是，url参数部分的的数据被用于HTML的代码

        攻击方式，针对于url中的可利用参数，攻击者构造一个带有js脚本的url，发送给用户，用户点击，触发XSS攻击

    - DOM型

        主要原理和反射型类似，不过是js利用了url哈希部分的参数作为html的内容输出

        攻击方式和反射型类似 

    - 存储型 

        主要原理，系统没有对用户的输入进行有效、足够的过滤，就把带有脚本的代码存储到数据库，也就是入库处理，之后，只要有用户或者是管理员向数据库申请这部分的的数据，也就是出库，html也没有对输出的内容进行检查，html加载了脚本代码，导致xss攻击

        攻击方式：攻击构造一个恶意脚本代码，通过输入点，提交到系统。系统对内容进行入库处理。用户请求html页面，系统向数据库申请这部分的数据，脚本被渲染成html代码并返回给用户，最后触发的xss攻击

    - 存储型XSS攻击的条件

        入库处理

        目标网页有攻击者可控的输入点

        输入信息可以在受害者的浏览器中显示

        输入具备宫嗯那个的可执行脚本，且在信息输入和输出的过程中没有特殊字符的过滤和字符转义等防护措施，或者防护措施可以通过一定的条件绕过

        出库处理

        浏览器将输入解析为脚本，并具备执行该脚本的能力

3. XSS攻击的利用方式

    盗取cookie等

4. XSS的测试方法

    此处是针对于存储型的xss测试思路

    难点：测试数据不一定回显到当前的浏览器，攻击要由用户进行触发

    基本思路：

    寻找输入点

    输入点一般是表单提交的地方（要有数据的回显）

    也可以是源码中的隐藏表单

    也可以通过抓包，查看参数位置确定输入点

    寻找输出点

    寻找输出点的原因，一般是为了确定输出位置的html环境（有没有其他嵌套标签）

    确定测试数据输出位置

    数据简单的xss脚本（alter弹框）

5. XSS攻击的绕过方式（更多的测试方法）

    - 闭合标签

        通过测试数据输出位置，查看输出位置的html环境，如出现了其他包含标签如

        ```html
        <textarea></textarea>
        ```

        可以通过闭合前一个标签，拼接脚本最后闭合后一个标签的方法来闭合包含标签 

        ```html
        </textarea><srcipt>alert(/xss/)<textarea> 
        ```

    - 大小写测试

        系统有可能通过黑名单的方法，过滤输入的特殊字符如'script'

        由于html，JavaScript对大小写不敏感，可以通过这种方法，绕过黑名单

        ```html
        <Srcipt>alert(/xss/)</Script> 
        ```

        防御方法

        完善黑名单

        使用白名单，如正则表达式

        字符串强制大小写配合黑名单

        字符串强制大小写的方法

        php

        strtolower() - 强制小写

        strtoupper() - 强制大写

        python

        str.upper() - 所有小写变成大写

        str.lower() - 所有大写变成小写

        str.capitalize - 第一个字母大写，其他小写

        str.title() - 每一个单词的首字母大写，其他小写

    - 多重嵌套测试

        这也是针对于系统设立黑名单过滤的绕过方法

        如果系统只对输入字符进行一次特殊字符过滤，那么就可以使用这种方法进行过滤，如过滤`<script>`

        ```html
        <scri<script>pt>alter(/xss/)</script>
        ```

        防御方法

        编写对输入字符串多重过滤的函数

        对输入字符串多重过滤的函数

6. XSS攻击防护方法

    除了上述的方法，最有效的方法大概是对尖括号进行转义了